<!DOCTYPE html>

<html>

<head>
  <meta charset="utf-8">
  <title>Newton's Cannon</title>
</head>

<body style="font-family:sans-serif; font-size:15px; width:600px; margin-left:auto; margin-right:auto; background-color:#e0e0e0;">

  <h1 style="font-size:24px; text-align:center;">
    Newton's Cannon
  </h1>

  <div style="width:500px; margin-left:auto; margin-right:auto; position:relative;">
    <img style="position:absolute;" src="NewtonDrawing.jpg" width="500" height="500">
    <canvas style="position:absolute;" id="trailCanvas" width="500" height="500">
        Canvas not supported; please update your browser.
    </canvas>
    <canvas style="position:relative;" id="theCanvas" width="500" height="500">
        Canvas not supported; please update your browser.
    </canvas>
  </div>

  <div style="text-align:center">
      <input type="button" value="Fire!" onclick="fireProjectile();">
      <input type="button" value="Clear" onclick="clearTrails();">
      Initial speed = <span id="speedReadout">3000</span> m/s
      <input type="range" id="speedSlider" min="0" max="8000" step="100" value="3000"
          oninput="showSpeed();" onchange="showSpeed();">
  </div>

  <p>This simulation is based on Isaac Newton's famous thought
  experiment and illustration of firing a projectile from a high
  mountaintop at various speeds, as he described in
  <a href="http://books.google.com/books?id=DXE9AAAAcAAJ">A
  Treatise of the System of the World</a>.</p>

  <script>
    var theCanvas = document.getElementById("theCanvas");
    var trailCanvas = document.getElementById("trailCanvas");
    var theContext = theCanvas.getContext("2d");
    var trailContext = trailCanvas.getContext("2d");
    var speedSlider = document.getElementById("speedSlider");
    var speedReadout = document.getElementById("speedReadout");
    var timer;
    var x, y, vx, vy;     // position and velocity
    var earthRadius = 6371000;   // meters
    var mountainHeight = earthRadius * 0.165;  // chosen to match image
    var x = 0;
    var y = earthRadius + mountainHeight;
    function showSpeed() {
        speedReadout.innerHTML = speedSlider.value;
    }
    function clearTrails() {
        trailContext.clearRect(0, 0, trailCanvas.width, trailCanvas.height);
        theContext.clearRect(0, 0, theCanvas.width, theCanvas.height);
    }
    function drawProjectile() {
        theContext.clearRect(0, 0, theCanvas.width, theCanvas.height);
        var metersPerPixel = earthRadius / (0.355 * theCanvas.width);
        var pixelX = theCanvas.width/2 + x/metersPerPixel;
        var pixelY = theCanvas.height/2 - y/metersPerPixel;
        trailContext.fillRect(pixelX-0.5, pixelY-0.5, 1, 1);
        theContext.beginPath();
        theContext.arc(pixelX, pixelY, 5, 0, 2*Math.PI);
        theContext.fillStyle = "red";
        theContext.fill();
    }
    function moveProjectile() {
        var r = Math.sqrt(x*x + y*y);
        if (r > earthRadius) {
            var newtonG = 6.67e-11;        // grav. constant in SI units
            var earthMass = 5.97e24;       // kilograms
            var dt = 5;                    // time step in seconds
            var accel = newtonG * earthMass / (r * r);  // magnitude of a
            var ax = -accel * x / r;
            var ay = -accel * y / r;
            vx += ax * dt;
            vy += ay * dt;
            var lastx = x;
            x += vx * dt;
            y += vy * dt;
            drawProjectile();
            if (!((lastx < 0) && (x >= 0))) {
                timer = window.setTimeout(moveProjectile, 1000/30);
            }
        }
        timer = window.setTimeout(moveProjectile, 1000/30);
    }
    function fireProjectile() {
        window.clearTimeout(timer);
        x = 0;
        y = earthRadius + mountainHeight;
        vx = Number(speedSlider.value);
        vy = 0;
        moveProjectile();
    }

  </script>

</body>

</html>
